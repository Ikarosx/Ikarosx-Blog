(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{533:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("昨天发的搭建vuepress，用到了scp来上传到云服务器"),t("br"),s._v("\n于是打算发一篇SSH登陆的"),t("br"),s._v("\n虽然以前也有用过"),t("br"),s._v("\n但不是很熟悉")])]),t("h2",{attrs:{id:"预备知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#预备知识"}},[s._v("#")]),s._v(" 预备知识")]),s._v(" "),t("h3",{attrs:{id:"两种级别的安全验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#两种级别的安全验证"}},[s._v("#")]),s._v(" 两种级别的安全验证")]),s._v(" "),t("p",[s._v("SSH有两种级别的安全验证")]),s._v(" "),t("ul",[t("li",[s._v("基于口令")]),s._v(" "),t("li",[s._v("基于密钥")])]),s._v(" "),t("h3",{attrs:{id:"非对称加密"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非对称加密"}},[s._v("#")]),s._v(" 非对称加密")]),s._v(" "),t("p",[s._v("非对称加密有两个密钥：公钥和私钥"),t("br"),s._v("\n公钥加密的需要用私钥解密"),t("br"),s._v("\n私钥加密的需要用公钥解密")]),s._v(" "),t("h2",{attrs:{id:"登陆命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登陆命令"}},[s._v("#")]),s._v(" 登陆命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有配置SSH密钥，回车后需要输入账号的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" 用户名@主机\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"口令登陆原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#口令登陆原理"}},[s._v("#")]),s._v(" 口令登陆原理")]),s._v(" "),t("img",{attrs:{src:"https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora/Ikaros/SSH%E5%AF%86%E7%A0%81%E7%99%BB%E9%99%86%E5%8E%9F%E7%90%86.png"}}),s._v(" "),t("h2",{attrs:{id:"密钥登陆原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#密钥登陆原理"}},[s._v("#")]),s._v(" 密钥登陆原理")]),s._v(" "),t("img",{attrs:{src:"https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora/Ikaros/SSH%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86%E5%8E%9F%E7%90%86.png"}}),s._v(" "),t("h2",{attrs:{id:"生成公私钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成公私钥"}},[s._v("#")]),s._v(" 生成公私钥")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t指定密钥算法，-C为备注")]),s._v("\nssh-keygen -t rsa -C "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"youemail@xx.com"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后会让你是否输入私钥的密码，测试用可以不输入")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("私钥密码")]),t("p",[s._v("不设置的时候，ssh可以直接免密登陆,但得确保证书不泄露"),t("br"),s._v("\n设置的时候，ssh需要输入私钥密码("),t("strong",[s._v("不是用户密码")]),s._v(")")])]),t("p",[s._v("生成的文件默认放在了"),t("code",[s._v("~/.ssh/")]),s._v("下")]),s._v(" "),t("ul",[t("li",[s._v("id_rsa")]),s._v(" "),t("li",[s._v("id_rsa.pub")])]),s._v(" "),t("h2",{attrs:{id:"证书登陆部署公钥到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#证书登陆部署公钥到服务器"}},[s._v("#")]),s._v(" 证书登陆部署公钥到服务器")]),s._v(" "),t("h3",{attrs:{id:"手动追加文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手动追加文件"}},[s._v("#")]),s._v(" 手动追加文件")]),s._v(" "),t("p",[s._v("把公钥追加到~/.ssh/authorized_keys文件里"),t("br"),s._v("\n上传公钥到服务器,用命令"),t("code",[s._v("cat id_rsa.pub >> authorized_keys")])]),s._v(" "),t("h3",{attrs:{id:"ssh-copy-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-copy-id"}},[s._v("#")]),s._v(" ssh-copy-id")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i指定你的公钥文件目录，后面跟上你要指定的用户名和服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果windows下命令未找到，可以尝试使用wsl里的命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我能在git上找到对应的命令，但无法运行，可能是不支持？")]),s._v("\nssh-copy-id -i ~/.ssh/id_rsa.pub ikarosx@ikarosx.cn\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("服务器如何寻找authorized_keys")]),t("p",[s._v("根据你选择的用户名,找到服务器对应用户下的.ssh目录的authorized_keys"),t("br"),s._v("\n如果不指定用户名，会先去"),t("code",[s._v("~/.ssh/config")]),s._v("找"),t("br"),s._v("\n如果没有找到，就会使用当前登录用户作为用户名")])]),t("h2",{attrs:{id:"登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),t("p",[s._v("部署公钥到服务器之后就可以使用证书登陆了")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" Ikarosx@ikarosx.cn\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"中间人攻击"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中间人攻击"}},[s._v("#")]),s._v(" 中间人攻击")]),s._v(" "),t("p",[s._v("使用口令登陆可能存在中间人攻击\n"),t("img",{attrs:{src:"https://ikaros-picture.oss-cn-shenzhen.aliyuncs.com/typora/Ikaros/SSH%E4%B8%AD%E9%97%B4%E8%80%85.png"}})]),s._v(" "),t("h4",{attrs:{id:"指纹验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指纹验证"}},[s._v("#")]),s._v(" 指纹验证")]),s._v(" "),t("p",[s._v("在第一次连接的时候会有一个提示")]),s._v(" "),t("blockquote",[t("p",[s._v("The authenticity of host 'xxxxx' can't be established."),t("br"),s._v("\nECDSA key fingerprint is SHA256:+0HbtPMHKf/OpdTOi4ze9yxz99YC37VtCH+6K8Re9kE."),t("br"),s._v("\nAre you sure you want to continue connecting (yes/no)?")])]),s._v(" "),t("p",[s._v("这个就是让我们确认这个主机的指纹是否是正确的")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("指纹哪里来")]),t("p",[s._v("指纹是来自服务器的ECDSA公钥指纹\n我们可以通过下面命令自己校验一下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -E可以指定算法,-l为查看指纹,-f指定文件 服务器的公钥存放在/etc/ssh里")]),s._v("\nssh-keygen -lf /etc/ssh/ssh_host_ecdsa_key.pub\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),t("p",[s._v("当我们输入yes的时候即表示信任该服务器"),t("br"),s._v("\n然后就会存放入"),t("code",[s._v("~/.ssh/known_hosts")]),s._v("里")]),s._v(" "),t("h2",{attrs:{id:"ssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[s._v("#")]),s._v(" .ssh")]),s._v(" "),t("h3",{attrs:{id:"config"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#config"}},[s._v("#")]),s._v(" config")]),s._v(" "),t("p",[s._v("我们在"),t("code",[s._v(".ssh/")]),s._v("下新建文件"),t("code",[s._v("config")]),t("br"),s._v("\n对其进行配置，以满足我们多样化的需求"),t("br"),s._v("\n默认情况下，不指定"),t("code",[s._v("-i")]),s._v("证书位置"),t("br"),s._v("\n会按顺序找下面几个文件，如果都不满足则要求你输入登陆密码")]),s._v(" "),t("ul",[t("li",[s._v("~/.ssh/id_rsa")]),s._v(" "),t("li",[s._v("~/.ssh/id_dsa")]),s._v(" "),t("li",[s._v("~/.ssh/id_ecdsa")]),s._v(" "),t("li",[s._v("~/.ssh/id_ed25519")])]),s._v(" "),t("p",[s._v("默认情况下不管我们连接哪台服务器都会去找几个私钥"),t("br"),s._v("\n那么当我们想要为多个服务器配置多个密钥就可以用config来指定")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 别名，即@之后的名字，如果@之后的是ikarosx1.cn，就会找到这里的HostName，这是实际访问的主机")]),s._v("\nHost ikarosx1.cn\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当ssh命令为ssh ikarosx.cn时会先来config找这里的User，找不到才是当前登陆用户")]),s._v("\n    User Ikarosx\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实际主机名")]),s._v("\n    HostName ikarosx.cn\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证书位置")]),s._v("\n    IdentityFile ~/.ssh/ikarosx/id_rsa\n\nHost github.com\n    User Ikarosx\n    HostName github.com\n    IdentityFile ~/.ssh/github/id_rsa\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"known-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#known-hosts"}},[s._v("#")]),s._v(" known_hosts")]),s._v(" "),t("p",[s._v("存放信任的主机")]),s._v(" "),t("h2",{attrs:{id:"结语"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),t("ul",[t("li",[s._v("本文所描述的是认证阶段，前面应该还有版本协商、算法协商和通过DH算法来交换密钥的过程")]),s._v(" "),t("li",[s._v("中间人攻击会发生在第一次连接的时候，所以要确保指纹验证是正确的")]),s._v(" "),t("li",[s._v("SSL和SSH有点类似，但SSH是人工验证指纹，而SSL使用的是CA机构来认证")])])])}),[],!1,null,null,null);a.default=n.exports}}]);